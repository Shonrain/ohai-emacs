(require 'composite)
(dolist (hook `(ediff-mode-hook
		mu4e-headers-mode-hook
		package-menu-mode-hook))
  (add-hook hook (lambda () (setq-local auto-composition-mode nil))))

;; support ligatures, some toned down to prevent hang
(when (version<= "27.0" emacs-version)
  (let ((alist
	 '((33 . ".\\(?:\\(==\\|[!=]\\)[!=]?\\)")
	   (35 . ".\\(?:\\(###?\\|_(\\|[(:=?[_{]\\)[#(:=?[_{]?\\)")
	   (36 . ".\\(?:\\(>\\)>?\\)")
	   (37 . ".\\(?:\\(%\\)%?\\)")
	   (38 . ".\\(?:\\(&\\)&?\\)")
	   (42 . ".\\(?:\\(\\*\\*\\|[*>]\\)[*>]?\\)")
	   ;; (42 . ".\\(?:\\(\\*\\*\\|[*/>]\\).?\\)")
	   (43 . ".\\(?:\\([>]\\)>?\\)")
	   ;; (43 . ".\\(?:\\(\\+\\+\\|[+>]\\).?\\)")
	   (45 . ".\\(?:\\(-[->]\\|<<\\|>>\\|[-<>|~]\\)[-<>|~]?\\)")
	   (46 . ".\\(?:\\(\\.[.<]\\|[-.=]\\)[-.<=]?\\)")
	   (47 . ".\\(?:\\(//\\|==\\|[=>]\\)[/=>]?\\)")
	   ;; (47 . ".\\(?:\\(//\\|==\\|[*/=>]\\).?\\)")
	   (48 . ".\\(?:\\(x[a-fA-F0-9]\\).?\\)")
	   (58 . ".\\(?:\\(::\\|[:<=>]\\)[:<=>]?\\)")
	   (59 . ".\\(?:\\(;\\);?\\)")
	   (60 . ".\\(?:\\(!--\\|\\$>\\|\\*>\\|\\+>\\|-[-<>|]\\|/>\\|<[-<=]\\|=[<>|]\\|==>?\\||>\\||||?\\|~[>~]\\|[$*+/:<=>|~-]\\)[$*+/:<=>|~-]?\\)")
	   (61 . ".\\(?:\\(!=\\|/=\\|:=\\|<<\\|=[=>]\\|>>\\|[=>]\\)[=<>]?\\)")
	   (62 . ".\\(?:\\(->\\|=>\\|>[-=>]\\|[-:=>]\\)[-:=>]?\\)")
	   (63 . ".\\(?:\\([.:=?]\\)[.:=?]?\\)")
	   (91 . ".\\(?:\\(|\\)|?\\)")
	   ;; (92 . ".\\(?:\\([\\n]\\)[\\]?\\)")
	   (94 . ".\\(?:\\(=\\)=?\\)")
	   (95 . ".\\(?:\\(|_\\|[_]\\)_?\\)")
	   (119 . ".\\(?:\\(ww\\)w?\\)")
	   (123 . ".\\(?:\\(|\\).?\\)")
	   (124 . ".\\(?:\\(->\\|=>\\||[-=>]\\||||*>\\|[]=>|}-]\\).?\\)")
	   (126 . ".\\(?:\\(~>\\|[-=>@~]\\).?\\)"))))
    (dolist (char-regexp alist)
      (set-char-table-range composition-function-table (car char-regexp)
			    `([,(cdr char-regexp) 0 font-shape-gstring])))))

(provide 'ohai-ligatures)
;;; ohai-ligatures.el ends here
